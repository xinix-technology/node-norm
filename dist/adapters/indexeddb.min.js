!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=59)}({12:function(e,t){e.exports=class{constructor({name:e}){this.name=e,this._hasTx=!1}async begin(){this._hasTx||(await this._begin(),this._hasTx=!0)}async commit(){this._hasTx&&(await this._commit(),this._hasTx=!1)}async rollback(){this._hasTx&&(await this._rollback(),this._hasTx=!1)}_begin(){}_commit(){}_rollback(){}}},14:function(e,t,r){const a=r(12),n=r(15);class i extends a{constructor(e){super(e),this.data=e.data||{}}load(e,t=(()=>{})){let r=this.data[e.schema.name]||[],{criteria:a,sorts:n}=e;if(r=r.filter(t=>this._matchCriteria(a,t,e.schema)),n){let e=Object.keys(n);r=r.sort((t,r)=>{let a=0;return e.forEach((i,s)=>{let o=n[i],d=Math.pow(2,e.length-s-1)*o;t[i]<r[i]?a-=d:t[i]>r[i]&&(a+=d)}),a})}return e.offset<0?r:(r=e.length<0?r.slice(e.offset):r.slice(e.offset,e.offset+e.length)).map(e=>(t(e),e))}insert(e,t=(()=>{})){const r=this.data[e.schema.name]=this.data[e.schema.name]||[];return e.rows.reduce((a,i)=>{let s={id:n()};for(let t in i)s[t]=e.schema.getField(t).serialize(i[t]);return r.push(s),t(s),++a},0)}update(e){let t=Object.keys(e.sets);return this.load(e).reduce((r,a)=>{return t.filter(t=>a[t]!==e.sets[t]&&(a[t]=e.schema.getField(t).serialize(e.sets[t]),!0)).length&&r++,r},0)}drop(e){delete this.data[e.schema.name]}truncate(e){this.data[e.schema.name]=[]}delete(e){const t=this.data[e.schema.name]=this.data[e.schema.name]||[];this.load(e).forEach(e=>{const r=t.indexOf(e);r>=0&&t.splice(r,1)})}async count(e,t){let{length:r,offset:a}=e;t||(e.offset=0,e.length=-1);let n=0;return await this.load(e,()=>n++),e.offset=a,e.length=r,n}_matchCriteria(e,t,r){if(!e)return!0;for(let a in e){let n=e[a],[i,s="eq"]=a.split("!"),o=r.getField(i),d=t[i];switch(s){case"or":{let e=!1;for(let a of n){if(this._matchCriteria(a,t,r)){e=!0;break}}if(!e)return!1;break}case"and":for(let e of n)if(!this._matchCriteria(e,t,r))return!1;break;case"eq":if(0!==o.compare(n,d))return!1;break;case"ne":if(0===o.compare(n,d))return!1;break;case"gt":if(o.compare(n,d)<=0)return!1;break;case"gte":if(o.compare(n,d)<0)return!1;break;case"lt":if(o.compare(n,d)>=0)return!1;break;case"lte":if(o.compare(n,d)>0)return!1;break;case"in":if(-1===o.indexOf(n,d))return!1;break;case"nin":if(-1!==o.indexOf(n,d))return!1;break;case"like":{let e=new RegExp(n);if(!d.match(e))return!1;break}case"regex":if(!d.match(n))return!1;break;case"where":if(!n(d,t))return!1;break;default:throw new Error(`Operator '${s}' is not implemented yet!`)}}return!0}}if("undefined"!=typeof window){let e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.Memory=i}e.exports=i},15:function(e,t,r){var a=r(16),n=r(17);e.exports=function(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||a)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[i+o]=s[o];return t||n(s)}},16:function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var a=new Uint8Array(16);e.exports=function(){return r(a),a}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},17:function(e,t){for(var r=[],a=0;a<256;++a)r[a]=(a+256).toString(16).substr(1);e.exports=function(e,t){var a=t||0,n=r;return[n[e[a++]],n[e[a++]],n[e[a++]],n[e[a++]],"-",n[e[a++]],n[e[a++]],"-",n[e[a++]],n[e[a++]],"-",n[e[a++]],n[e[a++]],"-",n[e[a++]],n[e[a++]],n[e[a++]],n[e[a++]],n[e[a++]],n[e[a++]]].join("")}},59:function(e,t,r){if("undefined"==typeof window)throw new Error("IndexedDB adapter only works at browser");const a=r(14),n=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;if(!window.indexedDB)throw new Error("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");class i extends a{constructor({name:e,dbname:t="db",version:r=1,onUpgradeNeeded:a=(()=>{})}){super({name:e}),this.dbname=t,this.version=r,this.onUpgradeNeeded=a}async load(e,t=(()=>{})){let{criteria:r}=e,a=await this.__getStore(e.schema.name);(await new Promise((t,n)=>{let i=[],s=a.openCursor();s.onsuccess=(a=>{let n=a.target.result;if(!n)return t(i);let s=n.value;this._matchCriteria(r,s,e.schema)&&i.push(s),n.continue()}),s.onerror=function(e){n(e)}})).forEach(e=>t(e))}async insert(e,t=(()=>{})){let r=await this.__getStore(e.schema.name),a=0;return await Promise.all(e.rows.map(async e=>{e.id=await this.__promised(r.add(e)),t(e),a++})),a}async update(e){let t=[];await this.load(e,e=>t.push(e));let r=await this.__getStore(e.schema.name),a=Object.keys(e.sets),n=0;return await Promise.all(t.map(t=>{if(a.filter(r=>t[r]!==e.sets[r]&&(t[r]=e.sets[r],!0)).length)return n++,this.__promised(r.put(t))})),n}async delete(e){let t=[];await this.load(e,e=>t.push(e));let r=await this.__getStore(e.schema.name);await t.map(e=>this.__promised(r.delete(e.id)))}async truncate(e){let t=await this.__getStore(e.schema.name);await this.__promised(t.clear())}drop(e){return this.truncate(e)}async __getDB(){let e=n.open(this.dbname,this.version);return e.onupgradeneeded=this.onUpgradeNeeded,await this.__promised(e)}__promised(e){return new Promise((t,r)=>{e.onsuccess=(e=>t(e.target.result)),e.onerror=r})}async __getTx(e){return(await this.__getDB()).transaction(e,"readwrite")}async __getStore(e){return(await this.__getTx(e)).objectStore(e)}}if("undefined"!=typeof window){let e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.IndexedDB=i}e.exports=i}});
//# sourceMappingURL=indexeddb.min.js.map