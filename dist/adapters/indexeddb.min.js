!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=58)}({11:function(e,t){e.exports=class{constructor({name:e}){this.name=e,this._hasTx=!1}async begin(){this._hasTx||(await this._begin(),this._hasTx=!0)}async commit(){this._hasTx&&(await this._commit(),this._hasTx=!1)}async rollback(){this._hasTx&&(await this._rollback(),this._hasTx=!1)}_begin(){}_commit(){}_rollback(){}}},13:function(e,t,r){const n=r(11),a=r(14);class i extends n{constructor(e){super(e),this.data=e.data||{}}load(e,t=(()=>{})){let r=this.data[e.schema.name]||[],{criteria:n,sorts:a}=e;if(n&&void 0!==n.id){const e=r.find(e=>e.id===n.id);r=e?[e]:[]}else{if(r=r.filter(e=>this._matchCriteria(n,e)),a){let e=Object.keys(a);r=r.sort((t,r)=>{let n=0;return e.forEach((i,s)=>{let o=a[i],d=Math.pow(2,e.length-s-1)*o;t[i]<r[i]?n-=d:t[i]>r[i]&&(n+=d)}),n})}if(e.offset<0)return r;r=e.length<0?r.slice(e.offset):r.slice(e.offset,e.offset+e.length)}return r.map(e=>(t(e),e))}insert(e,t=(()=>{})){const r=this.data[e.schema.name]=this.data[e.schema.name]||[];return e.rows.reduce((e,n)=>(n=Object.assign({id:a()},n),r.push(n),t(n),++e),0)}update(e){let t=Object.keys(e.sets);return this.load(e).reduce((r,n)=>{return t.filter(t=>n[t]!==e.sets[t]&&(n[t]=e.sets[t],!0)).length&&r++,r},0)}drop(e){delete this.data[e.schema.name]}truncate(e){this.data[e.schema.name]=[]}delete(e){const t=this.data[e.schema.name]=this.data[e.schema.name]||[];this.load(e).forEach(e=>{const r=t.indexOf(e);r>=0&&t.splice(r,1)})}async count(e,t){let{length:r,offset:n}=e;t||(e.offset=0,e.length=-1);let a=0;return await this.load(e,()=>a++),e.offset=n,e.length=r,a}_matchCriteria(e,t){if(!e)return!0;for(let r in e){let n=e[r],[a,i="eq"]=r.split("!"),s=t[a];switch(i){case"or":{let e=!1;for(let r of n){if(this._matchCriteria(r,t)){e=!0;break}}if(!e)return!1;break}case"and":for(let e of n)if(!this._matchCriteria(e,t))return!1;break;case"eq":if(n!==s)return!1;break;case"ne":if(n===s)return!1;break;case"gt":if(!(s>n))return!1;break;case"gte":if(!(s>=n))return!1;break;case"lt":if(!(s<n))return!1;break;case"lte":if(!(s<=n))return!1;break;case"in":if(-1===n.indexOf(s))return!1;break;case"nin":if(-1!==n.indexOf(s))return!1;break;case"like":{let e=new RegExp(n);if(!s.match(e))return!1;break}case"regex":if(!s.match(n))return!1;break;case"where":if(!n(s,t))return!1;break;default:throw new Error(`Operator '${i}' is not implemented yet!`)}}return!0}}if("undefined"!=typeof window){let e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.Memory=i}e.exports=i},14:function(e,t,r){var n=r(15),a=r(16);e.exports=function(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[i+o]=s[o];return t||a(s)}},15:function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},16:function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,a=r;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}},58:function(e,t,r){if("undefined"==typeof window)throw new Error("IndexedDB adapter only works at browser");const n=r(13),a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;if(!window.indexedDB)throw new Error("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");class i extends n{constructor({name:e,dbname:t="db",version:r=1,onUpgradeNeeded:n=(()=>{})}){super({name:e}),this.dbname=t,this.version=r,this.onUpgradeNeeded=n}async load(e,t=(()=>{})){let{criteria:r}=e,n=await this.__getStore(e.schema.name);(await new Promise((e,t)=>{let a=[],i=n.openCursor();i.onsuccess=(t=>{let n=t.target.result;if(!n)return e(a);let i=n.value;this._matchCriteria(r,i)&&a.push(i),n.continue()}),i.onerror=function(e){t(e)}})).forEach(e=>t(e))}async insert(e,t=(()=>{})){let r=await this.__getStore(e.schema.name),n=0;return await Promise.all(e.rows.map(async e=>{e.id=await this.__promised(r.add(e)),t(e),n++})),n}async update(e){let t=[];await this.load(e,e=>t.push(e));let r=await this.__getStore(e.schema.name),n=Object.keys(e.sets),a=0;return await Promise.all(t.map(t=>{if(n.filter(r=>t[r]!==e.sets[r]&&(t[r]=e.sets[r],!0)).length)return a++,this.__promised(r.put(t))})),a}async delete(e){let t=[];await this.load(e,e=>t.push(e));let r=await this.__getStore(e.schema.name);await t.map(e=>this.__promised(r.delete(e.id)))}async truncate(e){let t=await this.__getStore(e.schema.name);await this.__promised(t.clear())}drop(e){return this.truncate(e)}async __getDB(){let e=a.open(this.dbname,this.version);return e.onupgradeneeded=this.onUpgradeNeeded,await this.__promised(e)}__promised(e){return new Promise((t,r)=>{e.onsuccess=(e=>t(e.target.result)),e.onerror=r})}async __getTx(e){return(await this.__getDB()).transaction(e,"readwrite")}async __getStore(e){return(await this.__getTx(e)).objectStore(e)}}if("undefined"!=typeof window){let e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.IndexedDB=i}e.exports=i}});
//# sourceMappingURL=indexeddb.min.js.map